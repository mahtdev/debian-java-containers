FROM debian:12.12

# Actualizaicion del sistema
RUN apt update -y \
    && apt upgrade -y \
    && apt-get install --no-install-recommends -y \
    ca-certificates \
    apt-transport-https \
    lsb-release \
    wget \
    curl \
    telnet \
    nano \
    vim \
    iproute2 \
    procps \
    net-tools \
    maven \
    git \
    git-lfs \
    openssh-client \
    unzip \
    zip \
    zsh \
    zsh-common \
    build-essential \
    make \
    tree \
    htop \
    jq \
    bat \
    fd-find \
    ripgrep \
    faketime \
    && apt-get clean

COPY ./scripts/utils/jdk8.sh /tmp/
COPY ./packages/jdk-8u202-linux-x64.tar.gz /opt/

RUN chmod +x /tmp/jdk8.sh

# Instalar java
RUN bash /tmp/jdk8.sh
RUN rm /tmp/jdk8.sh

ENV JAVA_HOME=/opt/jdk-8
ENV PATH="${JAVA_HOME}/bin:${PATH}"
ENV SHELL=/usr/bin/zsh

# Configurar Zsh como shell por defecto y crear configuración básica
RUN chsh -s /usr/bin/zsh || true \
    && mkdir -p /root/.zsh \
    && echo 'export HISTSIZE=10000' >> /root/.zshrc \
    && echo 'export SAVEHIST=10000' >> /root/.zshrc \
    && echo 'export HISTFILE=~/.zsh_history' >> /root/.zshrc \
    && echo 'setopt SHARE_HISTORY' >> /root/.zshrc \
    && echo 'setopt APPEND_HISTORY' >> /root/.zshrc

# Crear alias útiles para desarrollo
RUN echo 'alias ll="ls -lah"' >> /root/.zshrc \
    && echo 'alias la="ls -A"' >> /root/.zshrc \
    && echo 'alias l="ls -CF"' >> /root/.zshrc \
    && echo 'alias ..="cd .."' >> /root/.zshrc \
    && echo 'alias ...="cd ../.."' >> /root/.zshrc \
    && echo 'alias grep="grep --color=auto"' >> /root/.zshrc \
    && echo 'alias fgrep="fgrep --color=auto"' >> /root/.zshrc \
    && echo 'alias egrep="egrep --color=auto"' >> /root/.zshrc \
    && echo 'alias cat="batcat 2>/dev/null || cat"' >> /root/.zshrc \
    && echo 'alias find="fdfind 2>/dev/null || find"' >> /root/.zshrc

# Configurar zona horaria para simular fecha específica
ENV TZ=UTC

# Scripts para ejecutar con fecha simulada
COPY ./scripts/utils/run_with_fake_date.sh /usr/local/bin/
COPY ./scripts/utils/run_java_fake_date.sh /usr/local/bin/
COPY ./scripts/utils/demo_fake_date.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/run_with_fake_date.sh /usr/local/bin/run_java_fake_date.sh /usr/local/bin/demo_fake_date.sh

# Crear directorio de trabajo y copiar archivos de ejemplo
WORKDIR /app
COPY ./scripts/utils/TestDate.java /app/

CMD ["zsh"]
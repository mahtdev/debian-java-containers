FROM debian:12.12

# Actualizaci칩n e instalaci칩n de herramientas
RUN apt update -y \
    && apt upgrade -y \
    && apt-get install --no-install-recommends -y \
    ca-certificates \
    apt-transport-https \
    lsb-release \
    wget \
    curl \
    telnet \
    nano \
    vim \
    iproute2 \
    procps \
    net-tools \
    maven \
    git \
    git-lfs \
    openssh-client \
    unzip \
    zip \
    zsh \
    zsh-common \
    build-essential \
    make \
    tree \
    htop \
    jq \
    bat \
    fd-find \
    ripgrep \
    faketime \
    sudo \
    && apt-get clean

# Java
COPY ./scripts/utils/jdk8.sh /tmp/
COPY ./packages/jdk-8u202-linux-x64.tar.gz /opt/
RUN chmod +x /tmp/jdk8.sh \
    && bash /tmp/jdk8.sh \
    && rm /tmp/jdk8.sh

ENV JAVA_HOME=/opt/jdk-8
ENV PATH="${JAVA_HOME}/bin:${PATH}"

# Crear usuario est치ndar para DevContainers
ARG DEV_USER=vscode
ARG DEV_UID=1000
ARG DEV_GID=1000

RUN groupadd --gid $DEV_GID $DEV_USER \
    && useradd --uid $DEV_UID --gid $DEV_GID -m $DEV_USER -s /bin/bash \
    && usermod -aG sudo $DEV_USER \
    && echo "$DEV_USER ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/$DEV_USER \
    && chmod 0440 /etc/sudoers.d/$DEV_USER

# Configuraci칩n Zsh para el usuario (sin romper bash)
RUN mkdir -p /home/$DEV_USER \
    && echo 'export PATH=$PATH' >> /home/$DEV_USER/.zshrc \
    && echo 'alias ll="ls -lah"' >> /home/$DEV_USER/.zshrc \
    && echo 'if [ -t 1 ]; then exec zsh; fi' >> /home/$DEV_USER/.bashrc \
    && chown -R $DEV_USER:$DEV_USER /home/$DEV_USER

# Crear workspace
RUN mkdir -p /workspace \
    && chown -R $DEV_USER:$DEV_USER /workspace

WORKDIR /workspace

RUN echo '#!/bin/sh\nexec sleep infinity' > /keep-alive.sh && chmod +x /keep-alive.sh
ENTRYPOINT ["/keep-alive.sh"]
